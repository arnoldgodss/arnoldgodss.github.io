(()=>{if(!customElements.get("theme-modal")){class ThemeModal extends HTMLElement{constructor(){super(),this.modalId="ThemeModal",this.modalContentSelector="[data-modal-content] .theme-modal--inner",this.focusableSelector='a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])',this.cacheDOMElements(),this.bindEventHandlers(),window._myModalCache=window._myModalCache||{}}cacheDOMElements(){if(this.sectionId=this.getAttribute("data-section-id"),this.sectionFetchId=this.getAttribute("data-section-fetch-id"),this.productUrl=this.getAttribute("data-product-url"),this.contentSelector=this.getAttribute("data-content-selector"),this.shouldFetchSection=this.hasAttribute("data-fetch-section"),this.blockId=this.getAttribute("data-block-id"),this.modalButton=this.querySelector("[data-modal-button]"),this.modalTemplate=this.querySelector("template"),this.overlay=document.querySelector("#DrawerOverlay"),this.modalContent=this.querySelector("[data-modal-content]"),!this.modalButton||!this.modalTemplate){console.warn("Theme Modal: Required elements missing");return}}bindEventHandlers(){this.showModal=this.showModal.bind(this),this.hideModal=this.hideModal.bind(this),this.handleKeydown=this.handleKeydown.bind(this)}connectedCallback(){if(this.modalButton.addEventListener("click",this.showModal),this.overlay&&this.overlay.addEventListener("click",this.hideModal),this.shouldFetchSection){const productCard=this.closest("product-card");if(productCard){let hoverTimer;productCard.addEventListener("mouseenter",()=>{hoverTimer=setTimeout(()=>{this.prefetch()},250)}),productCard.addEventListener("mouseleave",()=>clearTimeout(hoverTimer)),productCard.addEventListener("touchstart",()=>{this.prefetch()},{once:!0})}}window.Shopify.designMode&&document.addEventListener("shopify:section:load",async()=>{this.hideModal()})}disconnectedCallback(){this.modalButton.removeEventListener("click",this.showModal),this.overlay&&this.overlay.removeEventListener("click",this.hideModal),this.dismissButton&&this.dismissButton.removeEventListener("click",this.hideModal)}prefetch(){const url=this.productUrl||`${window.Shopify.routes.root}?section_id=${this.sectionFetchId}`;if(url){if(window._myModalCache[url]){this._prefetchedModalHTML=window._myModalCache[url];return}this.fetchModalContentInBackground().then(()=>{window._myModalCache[url]=this._prefetchedModalHTML}).catch(err=>{console.error("Prefetch error:",err)})}}async fetchModalContentInBackground(){try{const url=this.productUrl||`${window.Shopify.routes.root}?section_id=${this.sectionFetchId}`,response=await fetch(url);if(!response.ok)throw new Error(`Failed to fetch modal content: ${response.status}`);const textContent=await response.text(),doc=new DOMParser().parseFromString(textContent,"text/html"),relevantContent=this.contentSelector?doc.querySelector(this.contentSelector)?.innerHTML:textContent;this._prefetchedModalHTML=relevantContent||"",window.eventBus.emit("product:modal:prefetched",{sectionId:this.sectionId})}catch(error){throw console.error("Theme Modal: Error prefetching content",error),error}}initScrollHandler(el){if(!el)return;let scrolling;el.addEventListener("scroll",()=>{clearTimeout(scrolling),el.classList.add("scrolling"),scrolling=setTimeout(()=>{el.classList.remove("scrolling")},800)})}async render(){try{const modalContent=document.querySelector(`#${this.modalId}`);if(!modalContent)return console.warn("Theme Modal: Modal content element not found"),!1;if(modalContent.innerHTML=this.modalTemplate.innerHTML,this.modalContent=modalContent,this.dismissButton=this.modalContent.querySelector("[data-close]"),this.dismissButton&&this.dismissButton.addEventListener("click",this.hideModal),this._prefetchedModalHTML){const targetElement=document.querySelector(`#${this.modalId} ${this.modalContentSelector}`);if(!targetElement)return console.error("Modal content target element not found"),!1;targetElement.innerHTML=this._prefetchedModalHTML,window.eventBus.emit("product:modal:ready",{sectionId:this.sectionId})}else this.shouldFetchSection&&(this.sectionFetchId||this.productUrl)&&await this.fetchModalContent();return!0}catch(error){return console.error("Theme Modal: Error rendering modal",error),!1}}async showModal(e){if(e.stopPropagation(),e.preventDefault(),this.previousActiveElement=e.currentTarget,await this.render()&&(document.body.classList.add("theme-modal-open"),this.modalContent)){this.modalContent.classList.remove("hidden"),this.trapFocus();const scrollableInner=this.modalContent.querySelector("[data-modal-content]");scrollableInner&&this.initScrollHandler(scrollableInner)}}hideModal(){document.body.classList.remove("theme-modal-open"),this.modalContent&&(this.modalContent.classList.add("hidden"),window.eventBus.emit("product:modal:close",{sectionId:this.sectionId}),this.modalContent.innerHTML=""),this.previousActiveElement&&typeof this.previousActiveElement.focus=="function"&&this.previousActiveElement.focus(),document.removeEventListener("keydown",this.handleKeydown)}trapFocus(){const firstElement=this.modalContent.querySelectorAll(this.focusableSelector)[0];firstElement&&(document.addEventListener("keydown",this.handleKeydown),requestAnimationFrame(()=>firstElement.focus()))}handleKeydown(event){const focusableElements=this.modalContent.querySelectorAll(this.focusableSelector),firstElement=focusableElements[0],lastElement=focusableElements[focusableElements.length-1];if(!firstElement||!lastElement)return;const isTabPressed=event.key==="Tab";if(event.key==="Escape"){this.hideModal();return}isTabPressed&&(event.shiftKey&&document.activeElement===firstElement?(lastElement.focus(),event.preventDefault()):!event.shiftKey&&document.activeElement===lastElement&&(firstElement.focus(),event.preventDefault()))}async fetchModalContent(){try{const url=this.productUrl||`${window.Shopify.routes.root}?section_id=${this.sectionFetchId}`,response=await fetch(url);if(!response.ok)throw new Error(`Failed to fetch modal content: ${response.status}`);const textContent=await response.text(),doc=new DOMParser().parseFromString(textContent,"text/html"),modalContent=this.contentSelector?doc.querySelector(this.contentSelector)?.innerHTML:textContent,targetElement=document.querySelector(`#${this.modalId} ${this.modalContentSelector}`);if(!targetElement)throw new Error("Modal content target element not found");targetElement.innerHTML=modalContent||"",window.eventBus.emit("product:modal:ready",{sectionId:this.sectionId})}catch(error){console.error("Theme Modal: Error fetching content",error);const targetElement=document.querySelector(`#${this.modalId} ${this.modalContentSelector}`);targetElement&&(targetElement.innerHTML="<p>Sorry, there was an error loading the content. Please try again.</p>")}}}customElements.define("theme-modal",ThemeModal)}})();
//# sourceMappingURL=/cdn/shop/t/18/assets/component-theme-modal.js.map?v=30331729726393402961758233408
